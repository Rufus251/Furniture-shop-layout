function changeHeightChat(){const e=document.querySelector(".messenger");let t;const n=346/300*20;"424px"===e.style.height?(t=424,toggleChatVisibility()):t=78;let s=Date.now(),r=0,o=setInterval((()=>{if("424px"===e.style.height||1===r?(r=1,t-=n):t+=n,e.style.height=t+"px",Date.now()-s>300){clearInterval(o),t>300?(e.style.height="424px",toggleChatVisibility()):e.style.height="78px";return document.querySelector(".messenger__chat__text").scrollTop=99999999,0}}),20)}function toggleChatVisibility(){document.querySelector(".messenger__arrow__down").classList.toggle("none"),document.querySelector(".messenger__arrow__up").classList.toggle("none"),document.querySelector(".messenger__line").classList.toggle("none"),document.querySelector(".messenger__clip").classList.toggle("none"),document.querySelector(".messenger__input").classList.toggle("none"),document.querySelector(".messenger__send").classList.toggle("none"),document.querySelector(".messenger__send__btn").classList.toggle("none"),document.querySelector(".messenger__text").classList.toggle("none"),document.querySelector(".messenger__chat").classList.toggle("none")}function sendMessage(e){const t=document.querySelector(`.${e}`).value;if(""==t&&0==Array.from(document.querySelectorAll(".messenger__chat__image img")).length)return;document.querySelector(`.${e}`).value="";let n=document.querySelector(".messenger__chat__text"),s=document.createElement("div");if("messenger__input"===e?s.classList.add("messenger__chat__block__user"):s.classList.add("messenger__chat__block__operator"),n.append(s),n=s,s=document.createElement("p"),s.innerText=t,"messenger__input"===e)s.classList.add("messenger__chat__user");else if("operator__input"===e){s.classList.add("messenger__chat__support");document.querySelector(".messenger__operatorName__status").innerHTML="Online"}Array.from(document.querySelectorAll(".messenger__chat__image img")).forEach((e=>{const t=e.cloneNode(!0);t.classList.add("messenger__chat__user__image"),s.append(t),document.querySelector(".messenger__chat__image").remove()})),n.append(s);let r=new Date,o=String(r.getHours()),c=String(r.getMinutes());1==o.length&&(o="0"+o),1==c.length&&(c="0"+c);const a=o+":"+c;s=document.createElement("p"),s.innerText=a,s.classList.add("messenger__chat__timeSupport"),"messenger__input"===e&&s.classList.add("messenger__chat__timeUser"),n.append(s);document.querySelector(".messenger__chat__text").scrollTop=99999999,document.querySelector(".messenger__chat__imagePreview").style.height="0px";const _=document.querySelector(".messenger__chat__text").innerHTML;localStorage.setItem("chatHistory",_)}function changeStatus(){if(""==document.querySelector(".operator__input").value)return void(document.querySelector(".messenger__operatorName__status").innerHTML="Online");document.querySelector(".messenger__operatorName__status").innerHTML="Печатает..."}function imgPreview(e){console.log("imgPreview");const t=Array.from(e.files),n=document.querySelector(".messenger__chat__imagePreview");n.innerHTML="",n.style.height="147px",t.forEach((e=>{const t=new FileReader;t.onload=t=>{n.insertAdjacentHTML("beforeend",`\n\n            <div class="messenger__chat__image">\n\n            <div class="messenger__chat__image__remove" data-name="${e.name}"> &times;</div>\n            <img src="${t.target.result}" class="" />\n            \n            </div>\n            `)},t.readAsDataURL(e)}))}function delImage(e){let t=[...e];if(!event.target.dataset.name)return;const n=event.target.dataset.name;t=t.filter((e=>e.name!==n));document.querySelector(`[data-name="${n}"]`).closest(".messenger__chat__image").remove()}document.querySelector(".messenger__chat__text").innerHTML=localStorage.getItem("chatHistory");const upPanel=document.querySelector(".messenger__upPanel"),operatorInput=document.querySelector(".operator__input");upPanel.addEventListener("click",changeHeightChat),document.addEventListener("keydown",(e=>{"Enter"==e.code?sendMessage("messenger__input"):"ShiftRight"==e.code&&sendMessage("operator__input")})),operatorInput.addEventListener("input",changeStatus);const image_select=document.querySelector(".messenger__clip__file");image_select.addEventListener("change",(function(){imgPreview(image_select)})),document.querySelector(".messenger").addEventListener("click",(function(){delImage(image_select.files)}));